<?xml version="1.0" encoding="utf-8"?>
<TfrxReport Version="4.12" DotMatrixReport="False" IniFile="E:\Projects\Selsovet7\Work\FastReports.ini" OldStyleProgress="True" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="40375.6190210764" ReportOptions.Description.Text="" ReportOptions.LastChange="41709.489370706" ScriptLanguage="PascalScript" ScriptText.Text="var&#13;&#10;  s,sRusGr,sSort,strDate,ss,sAdr,sAdr2,strSQL,strNameUch:String;&#13;&#10;  sNameV,sTimeV,sAdresV,sDosr:String;&#13;&#10;  n,nUch,ns,nIDUch:Integer;&#13;&#10;  nYear,nMonth,nDay : Word;&#13;&#10;  d,d1:TDateTime;&#13;&#10;  SprUch:TDataSet;                    &#13;&#10;&#13;&#10;  &#13;&#10;procedure Button1OnClick(Sender: TfrxComponent);&#13;&#10;//FIO,DATEV,NAMEV,FIO,TIMEV,ADRES,DOSR&#13;&#10;begin&#13;&#10;  // включать граждан россии в списки&#13;&#10;  if ParamAsBoolean('RUSGR_VIBOR') then begin&#13;&#10;    sRusGr:='n.citizen=643 or';&#13;&#10;  end else begin&#13;&#10;    sRusGr:='';&#13;&#10;  end;&#13;&#10;  SprUch := dbGetDataSet('dmBase.SprIzbUch') ;&#13;&#10;  SprUch.First;&#13;&#10;  if not SprUch.Eof then begin&#13;&#10;    n := SprUch.Fld('NOMER').AsInteger;&#13;&#10;  end else begin&#13;&#10;    PutError(' Заполните справочник избирательных участков ! ');&#13;&#10;    exit;&#13;&#10;  end;&#13;&#10;  f := TfmParamQuest.Create(nil);&#13;&#10;  f.Caption := 'Введите парамерты';&#13;&#10;//  f.StepY:=17;&#13;&#10;//  f.Flat:=false;&#13;&#10;  f.AddParamEx(GlobalTask.ParamAsDate('DATE_VIBOR'), 'Дата выборов' , 'DATEVZ' ,'TYPE=DATE');&#13;&#10;  f.AddParamEx(n      , 'Избирательный участок' , 'IZBUCH','');&#13;&#10;  s:=Trim(GlobalTask.GetLastValueAsString('NAME_VIBOR'));&#13;&#10;  if s='' then s:='выбары депутатаў мясцовых Саветаў';&#13;&#10;  f.AddParamEx(s, 'Название выборов' , 'NAMEV','TYPE=STRING~WIDTH=500');&#13;&#10;  s:=Trim(GlobalTask.GetLastValueAsString('TIME_VIBOR'));&#13;&#10;  if s='' then s:='з 8 да 20 гадзiн';&#13;&#10;  f.AddParamEx(s, 'Время выборов' , 'TIME_VIBOR','TYPE=STRING~WIDTH=500');&#13;&#10;  f.AddParamEx(GlobalTask.GetLastValueAsString('ADRES_UCH_VIBOR'), 'Адрест участка' , 'ADRESV','TYPE=STRING~WIDTH=500');&#13;&#10;  s:=Trim(GlobalTask.GetLastValueAsString('DOSR_VIBOR'));&#13;&#10;  if s='' then s:='датэрмiнова з 18 па 22 сакавiка бягучага года ўключна з 10 да 14 гадзiн i з 16 да 19 гадзiн у памяшканнi ўчастковай выбарчай камiсii';&#13;&#10;  f.AddParamEx(s, 'Время досрочных выборов' , 'TIME_DOSR','TYPE=STRING~WIDTH=500');&#13;&#10;  f.AddParamEx(1, 'Тип сортировки' , 'SORT','TYPE=LIST~DESC=KEY_SORTIZB~WIDTH=200');&#13;&#10;&#13;&#10;  f.AddButtons('Выполнить~Отказ',0);&#13;&#10;  n  := f.ShowQuest;&#13;&#10;  try&#13;&#10;  if n = 1 then begin&#13;&#10;    lAdresFromLic:=false;         //     !!!&#13;&#10;    ns := f.GetValue('SORT','I');&#13;&#10;    d  := f.GetValue('DATEVZ','D');&#13;&#10;    sNameV:=f.GetValue('NAMEV','S');&#13;&#10;    sTimeV:=f.GetValue('TIME_VIBOR','S');&#13;&#10;    sAdresV:=f.GetValue('ADRESV','S');&#13;&#10;    sDosr:=f.GetValue('TIME_DOSR','S');&#13;&#10;&#13;&#10;    GlobalTask.SetLastValueAsDate('DATE_VIBOR', d);&#13;&#10;    GlobalTask.SetLastValueAsString('NAME_VIBOR',sNameV);&#13;&#10;    GlobalTask.SetLastValueAsString('TIME_VIBOR',sTimeV);&#13;&#10;    GlobalTask.SetLastValueAsString('ADRES_UCH_VIBOR',sAdresV);&#13;&#10;    GlobalTask.SetLastValueAsString('DOSR_VIBOR',sDosr);&#13;&#10;    if Length(sNameV)&#60;45 then sNameV:=sNameV+chr(13);&#13;&#10;    DecodeDate(d,nYear,nMonth,nDay);&#13;&#10;    nYear := nYear-18;&#13;&#10;    nUch := f.GetValue('IZBUCH','N');&#13;&#10;    f.Free;&#13;&#10;    d1 := EncodeDate(nYear,nMonth,nDay);&#13;&#10;    strDate := DateToSQL(d);&#13;&#10;    if not dbLocate(SprUch,'NOMER',[nUch],'') then begin&#13;&#10;      PutError(' Не выбран избирательный участок !');&#13;&#10;    end else begin&#13;&#10;      if ParamAsInteger('CH_ADRES')=0 &#13;&#10;        then sSort:='d.punkt'&#13;&#10;        else sSort:='s.nomer';&#13;&#10;      //---- определим сортировать или нет нас. пункты по номеру -----&#13;&#10;//      q:=dbOpenSQL('SELECT count(*) as nnn FROM СпрНасПунктов WHERE nomer is null','');&#13;&#10;//      if q.Fld('nnn').AsInteger=0 then sSort:='s.nomer' else sSort:='d.punkt';&#13;&#10;//      dbClose(q);&#13;&#10;      //---------------------------------------------------------------&#13;&#10;      if lAdresFromLic  then begin  // !!!&#13;&#10;        sAdr:=' LEFT JOIN БазаДомов d ON d.date_fiks=l.date_fiks and d.id=l.adres_id ';&#13;&#10;        sAdr2:='l.adres_id';&#13;&#10;      end else begin&#13;&#10;        sAdr:=' LEFT JOIN БазаДомов d ON d.date_fiks=n.date_fiks and d.id=n.adres_id ';&#13;&#10;        sAdr2:='n.adres_id';&#13;&#10;      end;&#13;&#10;      strNameUch := SprUch.Fld('NAME').AsString;&#13;&#10;      nIDUch := SprUch.Fld('ID').AsInteger;&#13;&#10;      s := SprUch.Fld('PUNKTS').AsString;&#13;&#10;      ss:= GetFieldWhere(s,'id');&#13;&#10;//      s := GetFieldWhere2(s,'d.Punkt',SprUch.Fld('UL').AsString,'d.ul');&#13;&#10;      s := GetWherePunktUlDom(nIDUch,s,'d.Punkt',SprUch.Fld('UL').AsString,'d.ul',dbGetDataSet('dmBase.SprIzbUch2'), false);&#13;&#10;//      s := GetFieldWhere(s,'d.Punkt');&#13;&#10;      strSQL := 'SELECT s.nomer, familia, n.name name1, otch, dater, lic_id, d.punkt, '+sAdr2+', n.adres_id_git, 1 ppp, d.ul, d.dom, d.dom1, d.dom2, d.korp, d.kv '+&#13;&#10;        ' FROM Население n '+&#13;&#10;        ' LEFT JOIN ЛицевыеСчета l ON l.date_fiks=n.date_fiks and l.id=n.lic_id '+&#13;&#10;        sAdr+   // LEFT JOIN БазаДомов&#13;&#10;        ' LEFT JOIN СпрНасПунктов s ON d.punkt=s.id '+&#13;&#10;        ' WHERE n.date_fiks='+QStr('1899-12-30')+' and ( '+sRusGr+' n.citizen=112 or n.citizen is null ) and '+&#13;&#10;        ' (n.notselect is null or n.notselect=false) and (n.adres_id is not null and n.adres_id&#62;0) and '+&#13;&#10;        getStrPropis+' and '+&#13;&#10;        ' (TIMESTAMPDIFF(SQL_TSI_YEAR,n.DATER,'+strDate+')&#62;18 '+&#13;&#10;        ' or (TIMESTAMPDIFF(SQL_TSI_YEAR,n.DATER,'+strDate+'))=18 and '+&#13;&#10;        ' dater&#60;='+DateToSQL(d1)+' ) and ('+ s + ') ';&#13;&#10;//      if ns&#60;&#62;4 then begin&#13;&#10;//        strSQL:=strSQL+'   union all '+&#13;&#10;//        ' SELECT nomer, '+QStr(' ')+', name as name1, '+QStr(' ')+', CURDATE( ), 0, id as punkt, 0, 0, 0, 0, '+QStr('')+','+QStr('')+','+QStr('')+','+QStr('')+','+QStr('')+&#13;&#10;//        ' FROM СпрНасПунктов WHERE '+ss+' ';&#13;&#10;//      end;&#13;&#10;      if ns=1 then begin&#13;&#10;        strSQL := strSQL+' ORDER BY '+sSort+',familia,name1';&#13;&#10;      end else if ns=2 then begin&#13;&#10;        strSQL := strSQL+' ORDER BY '+sSort+',ppp,d.ul,d.dom1,d.dom2,d.korp,d.kv';&#13;&#10;      end else if ns=3 then begin&#13;&#10;        strSQL := strSQL+' ORDER BY '+sSort+',ppp,d.ul,familia';&#13;&#10;      end else begin&#13;&#10;        strSQL := strSQL+' ORDER BY familia,name1';&#13;&#10;      end;&#13;&#10;//      writedebug(strSQL);&#13;&#10;      OpenMessage(' Формирование  ... ','',10);&#13;&#10;//      writedebug(strSQL);&#13;&#10;      q:=dbOpenSQL(strSQL,'');&#13;&#10;      tb:=GetTemplateDataSet('TABLSOST');&#13;&#10;      while not q.Eof do begin&#13;&#10;        tb.Append;&#13;&#10;        if PolFrom(q.Fld('Name1').AsString,q.Fld('Otch').AsString)='М'&#13;&#10;          then tb.Fld('POL').AsString:='Паважаны' else tb.Fld('POL').AsString:='Паважаная';&#13;&#10;        tb.Fld('FIO').AsString:=FirstUpper(q.Fld('Familia').AsString)+' '+FirstUpper(q.Fld('Name1').AsString)+' '+FirstUpper(q.Fld('Otch').AsString);&#13;&#10;        tb.Fld('DATEV').AsString:=DatePropisBel(d,5)&#13;&#10;        tb.Fld('NAMEV').AsString:=sNameV;&#13;&#10;        tb.Fld('TIMEV').AsString:=sTimeV;&#13;&#10;        tb.Fld('UCH').AsString:=IntToStr(n);&#13;&#10;        tb.Fld('ADRESV').AsString:=sAdresV&#13;&#10;        tb.Fld('DOSR').AsString:=sDosr; &#13;&#10;        tb.Post;&#13;&#10;        q.Next;&#13;&#10;      end;&#13;&#10;      dbClose(q);&#13;&#10;      CloseMessage;&#13;&#10;      if dbRecordCount(tb)&#62;0 then  Result:=true;&#13;&#10;    end;&#13;&#10;  end;&#13;&#10;  finally&#13;&#10;&#13;&#10;  end;&#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." StoreInDFM="False" PropData="08446174617365747301010C2400000020446174615365743D2251756572792220446174615365744E616D653D225175657279220000095661726961626C65730100055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxADSQuery Name="Query" UserName="Query" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="" SourceTableType="ttAdsADT" CharType="ANSI" RequestLive="False" PropData="05704C6566740389000470546F70025D0A506172616D65746572730100"/>
  </TfrxDataPage>
  <TfrxDialogPage Name="DialogPage1" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Height="301" ClientHeight="263" Left="302" Top="129" Width="455" ClientWidth="439">
    <TfrxButtonControl Name="Button1" Left="230" Top="218" Width="75" Height="25" ShowHint="True" Caption="Button1" OnClick="Button1OnClick"/>
    <TfrxButtonControl Name="Button2" Left="328" Top="218" Width="75" Height="25" ShowHint="True" Caption="Button2"/>
    <TfrxDateEditControl Name="DateEdit1" Left="180" Top="18" Width="145" Height="21" ShowHint="True" Color="-16777211" Date="41709.4841176736" Time="41709.4841176736" WeekNumbers="False"/>
    <TfrxLabelControl Name="Label1" Left="14" Top="19" Width="83" Height="16" ShowHint="True" Caption="Дата выборов" Color="-16777201"/>
    <TfrxLabelControl Name="Label2" Left="13" Top="50" Width="142" Height="16" ShowHint="True" Caption="Избирательный участок" Color="-16777201"/>
    <TfrxLabelControl Name="Label3" Left="13" Top="85" Width="112" Height="16" ShowHint="True" Caption="Название выборов" Color="-16777201"/>
    <TfrxLabelControl Name="Label4" Left="13" Top="116" Width="94" Height="16" ShowHint="True" Caption="Время выборов" Color="-16777201"/>
  </TfrxDialogPage>
  <TfrxReportPage Name="Page1" PaperWidth="210" PaperHeight="297" PaperSize="9" LeftMargin="0" RightMargin="0" TopMargin="0" BottomMargin="0" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="" OnAfterPrint="Page1OnAfterPrint" OnBeforePrint="Page1OnBeforePrint">
    <TfrxReportTitle Name="ReportTitle1" Height="220" Left="0" Top="16" Width="793.7013">
      <TfrxMemoView Name="Memo1" Left="16" Top="12" Width="240" Height="16" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[s]"/>
      <TfrxMemoView Name="Memo2" Left="16" Top="48" Width="392" Height="16" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[ss]"/>
      <TfrxMemoView Name="Memo3" Left="16" Top="84" Width="408" Height="16" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[sss]"/>
      <TfrxMemoView Name="Memo4" Left="16" Top="124" Width="336" Height="16" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[sbase]"/>
      <TfrxMemoView Name="Memo5" Left="16" Top="156" Width="80" Height="16" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[sFIO]"/>
      <TfrxMemoView Name="Memo6" Left="20" Top="188" Width="588" Height="16" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[sDeti]"/>
    </TfrxReportTitle>
    <TfrxMasterData Name="MasterData1" Height="20" Left="0" Top="296" Width="793.7013" ColumnWidth="0" ColumnGap="0" DataSet="dmMen.frx__CurListDeti" DataSetName="Mens_Child" RowCount="0">
      <TfrxMemoView Name="Mens_ChildFAMILIA" Left="12" Top="0" Width="156" Height="16" ShowHint="False" DataField="FAMILIA" DataSet="dmMen.frx__CurListDeti" DataSetName="Mens_Child" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[Mens_Child.&#34;FAMILIA&#34;]"/>
      <TfrxMemoView Name="Mens_ChildNAME" Left="188" Top="0" Width="144" Height="16" ShowHint="False" DataField="NAME" DataSet="dmMen.frx__CurListDeti" DataSetName="Mens_Child" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[Mens_Child.&#34;NAME&#34;]"/>
      <TfrxMemoView Name="Mens_ChildOTCH" Left="360" Top="0" Width="160" Height="16" ShowHint="False" DataField="OTCH" DataSet="dmMen.frx__CurListDeti" DataSetName="Mens_Child" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[Mens_Child.&#34;OTCH&#34;]"/>
      <TfrxMemoView Name="Mens_ChildDATER" Left="556" Top="0" Width="80" Height="16" ShowHint="False" DataField="DATER" DataSet="dmMen.frx__CurListDeti" DataSetName="Mens_Child" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[Mens_Child.&#34;DATER&#34;]"/>
    </TfrxMasterData>
  </TfrxReportPage>
</TfrxReport>
