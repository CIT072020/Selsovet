<?xml version="1.0" encoding="utf-8"?>
<TfrxReport Version="4.12" DotMatrixReport="False" IniFile="E:\Projects\Selsovet7\Work\FastReports.ini" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.Author="Вадим Чура" ReportOptions.CreateDate="38251.4373884143" ReportOptions.Description.Text="" ReportOptions.Name="Запись акта о браке" ReportOptions.LastChange="43944.4618397801" ReportOptions.VersionMajor="1" ReportOptions.VersionMinor="1" ReportOptions.VersionRelease="1" ScriptLanguage="PascalScript" ScriptText.Text="var&#13;&#10;  sSort,strAdres,strFIO,strLich,strUNP,strName,sGod,sSQL,s,strNalog,strDate:String;                           &#13;&#10;  nTypeObj,nLich,nNalog,nDolg:Integer;&#13;&#10;  &#13;&#10;procedure DialogPage1OnShow(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  nTypeObj:=PropCurGurnal('TYPEEDITOBJ',0);&#13;&#10;  if nTypeObj=_TypeObj_Lich then begin&#13;&#10;    cbType.ItemIndex:=0;  &#13;&#10;  end else if nTypeObj=_TypeObj_Adres then begin&#13;&#10;    cbType.ItemIndex:=1;  &#13;&#10;  end else begin&#13;&#10;    cbType.ItemIndex:=2;  &#13;&#10;  end;            &#13;&#10;        &#13;&#10;  s:=Copy(FormatDateTime('yyyy-mm-dd',Now),1,4);&#13;&#10;  edGod.Text:=s;&#13;&#10;//  edGod.KeyIndex:='2014'; //s;&#13;&#10;//  edGod.ItemIndex:=0; //s;&#13;&#10;  cbAll.Checked:=true;&#13;&#10;  edNalog.KeyValue:='1';&#13;&#10;  edNalog.Enabled:=false;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure Page2OnBeforePrint(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  with Page2, Engine do&#13;&#10;  begin&#13;&#10;//  s := GetAdres('MAIN');&#13;&#10;//  s := ChoiceKey('KEY_TUL');&#13;&#10;//  if Length(s)&#62;0 then begin&#13;&#10;//    ss:=ValueKey('KEY_TUL',s);&#13;&#10;//    Edit1.text:=s+'/'+ss;&#13;&#10;//  end;                                                 &#13;&#10;//  MessageBox(Parameters(' main_select'),'');&#13;&#10;  end&#13;&#10;end;&#13;&#10;&#13;&#10;procedure btOkOnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  strDate := FormatDateTime('YYYY-MM-DD', GetDateFiks()); // '1899-12-30';&#13;&#10;  sGod:=trim(edGod.Text); // 2004;&#13;&#10;  sGod:=Replace(sGod, '_', '');&#13;&#10;    &#13;&#10;  nNalog := 0;&#13;&#10;  nDolg  := 0;&#13;&#10;  if ParamAsInteger('CH_ADRES')=0 &#13;&#10;    then sSort:='s.id' &#13;&#10;    else sSort:='s.nomer';&#13;&#10;      &#13;&#10;//  strNalog := edNalog.LookupValue;&#13;&#10;  if cbType.ItemIndex=0 then begin // по лицевым счетам&#13;&#10;    nTypeObj:=_TypeObj_Lich;                                                    &#13;&#10;    strName:='Наниматель (собственник)';&#13;&#10;    strUNP:='УНП';                    &#13;&#10;    mUnp.Visible:=true;   // adresToString(l.adres_id,n.date_fiks,n.adres_id)  &#13;&#10;    sSQL:='SELECT l.adres_id, n.unp, l.nomer, getFIO(n.Familia,n.Name,n.Otch) fio, '' '' adres, nn.* FROM ('+CRLF+              &#13;&#10;          '  SELECT id, sum(isnull(summa_vist,0)) sum_vist, sum(isnull(summa_opl,0)) sum_opl '+CRLF+      &#13;&#10;          '  FROM Nalogi '+CRLF+      &#13;&#10;          '  WHERE date_fiks=''1899-12-30'' and typeobj=2 &#38;god&#38; &#38;vnalog&#38; '+CRLF+       &#13;&#10;          '  GROUP BY 1 '+CRLF+      &#13;&#10;          '  HAVING  sum(isnull(summa_vist,0)) &#62; sum(isnull(summa_opl,0)) &#38;dolg&#38;) nn '+CRLF+      &#13;&#10;          '  LEFT JOIN ЛицевыеСчета l ON l.date_fiks=''1899-12-30'' and l.id=nn.id '+CRLF+      &#13;&#10;          '  LEFT JOIN Население    n ON n.date_fiks=''1899-12-30'' and l.first=n.id '+CRLF+       &#13;&#10;          '  LEFT JOIN БазаДомов    a ON a.date_fiks=''1899-12-30'' and a.id=l.adres_id'+CRLF+&#13;&#10;          '  LEFT JOIN СпрНасПунктов s ON a.punkt=s.id'+CRLF+&#13;&#10;          'ORDER BY '+sSort+', a.ul, a.dom1, a.dom2, a.kv';  &#13;&#10;              &#13;&#10;  end else if cbType.ItemIndex=1 then begin // по адресной книге&#13;&#10;    nTypeObj:=_TypeObj_Adres;                                                    &#13;&#10;    strName:='Собственник';                            &#13;&#10;    strUNP:='';&#13;&#10;    mUnp.Visible:=false;&#13;&#10;    mLich.Width:=137;   // !!!!!!!!!!!!!!                                            &#13;&#10;    sSQL:='SELECT a.id adres_id, '' '' unp, 0 nomer, '' '' fio, '' '' adres, nn.* FROM ( '+CRLF+              &#13;&#10;          '  SELECT id, sum(isnull(summa_vist,0)) sum_vist, sum(isnull(summa_opl,0)) sum_opl '+CRLF+     &#13;&#10;          '    FROM Nalogi '+CRLF+   &#13;&#10;          '    WHERE date_fiks=''1899-12-30'' and typeobj=1 &#38;god&#38; &#38;vnalog&#38; '+CRLF+   &#13;&#10;          '    GROUP BY 1 '+CRLF+  &#13;&#10;          '    HAVING  sum(isnull(summa_vist,0)) &#62; sum(isnull(summa_opl,0)) &#38;dolg&#38;) nn '+CRLF+  &#13;&#10;          '  LEFT JOIN БазаДомов a ON a.date_fiks=''1899-12-30'' and a.id=nn.id'+CRLF+        &#13;&#10;          '  LEFT JOIN СпрНасПунктов s ON a.punkt=s.id'+CRLF+&#13;&#10;          'ORDER BY '+sSort+', a.ul, a.dom1, a.dom2, a.kv';  &#13;&#10;  end else begin // по всем&#13;&#10;    nTypeObj:=0;                                                    &#13;&#10;    strName:='Собственник';                            &#13;&#10;    strUNP:='';                    &#13;&#10;    mUnp.Visible:=false;                                                            &#13;&#10;    mLich.Width:=137;  // !!!!!!!!!!!!!!                                                                             &#13;&#10;    sSQL:='SELECT nn.adres_id, '' '' unp, 0 nomer, '' '' fio, '' '' adres, nn.* FROM ( '+CRLF+  &#13;&#10;          '  SELECT IsNull(a.id,l.adres_id) adres_id, sum(isnull(summa_vist,0)) sum_vist, sum(isnull(summa_opl,0)) sum_opl '+CRLF+  &#13;&#10;          '    FROM Nalogi n '+CRLF+  &#13;&#10;          '    LEFT JOIN ЛицевыеСчета l ON l.date_fiks=''1899-12-30'' and l.id=n.id '+CRLF+   &#13;&#10;          '    LEFT JOIN БазаДомов a    ON a.date_fiks=''1899-12-30'' and a.id=n.id '+CRLF+  &#13;&#10;          '    WHERE n.date_fiks=''1899-12-30'' and (typeobj=1 or typeobj=2) &#38;god&#38; &#38;vnalog&#38; '+CRLF+   &#13;&#10;          '    GROUP BY 1 '+CRLF+  &#13;&#10;          '    HAVING sum(isnull(summa_vist,0)) &#62; sum(isnull(summa_opl,0)) &#38;dolg&#38;) nn'+CRLF+    &#13;&#10;          '  LEFT JOIN БазаДомов aa ON aa.date_fiks=''1899-12-30'' and aa.id=nn.adres_id'+CRLF+        &#13;&#10;          '  LEFT JOIN СпрНасПунктов s ON aa.punkt=s.id'+CRLF+&#13;&#10;          'ORDER BY '+sSort+', aa.ul, aa.dom1, aa.dom2, aa.kv';  &#13;&#10;  end;&#13;&#10;&#13;&#10;  Query.SQL.Text:=sSQL;&#13;&#10;    &#13;&#10;  if sGod&#60;&#62;''&#13;&#10;    then Query.SQL.Text:=Replace(Query.SQL.Text, '&#38;god&#38;', ' and god='+sGod)   // конктетный год                                                         &#13;&#10;    else Query.SQL.Text:=Replace(Query.SQL.Text, '&#38;god&#38;', '');                // за все года                               &#13;&#10;&#13;&#10;  if sGod&#60;&#62;''&#13;&#10;    then sGod:=sGod+' год'&#13;&#10;    else sGod:='весь период';        &#13;&#10;        &#13;&#10;  if cbDolg.Checked&#13;&#10;    then Query.SQL.Text:=Replace(Query.SQL.Text, '&#38;dolg&#38;', '')              // только должники                                      &#13;&#10;    else Query.SQL.Text:=Replace(Query.SQL.Text, '&#38;dolg&#38;', '  or 1=1');     // все               &#13;&#10;  &#13;&#10;//  showmessage(edNalog.KeyValue);  &#13;&#10;  if (edNalog.Text&#60;&#62;'') and (edNalog.KeyValue&#60;&#62;null) and not cbAll.Checked then begin&#13;&#10;//    s:=edNalog.KeyValue;        &#13;&#10;    Query.SQL.Text := Replace(Query.SQL.Text, '&#38;vnalog&#38;', ' and nalog='+inttostr(edNalog.KeyValue));&#13;&#10;    strNalog := ValueSpr('SprNalogi-&#62;ID',edNalog.KeyValue,'Name')+ ' за '+sGod;&#13;&#10;  end else begin&#13;&#10;    Query.SQL.Text := Replace(Query.SQL.Text, '&#38;vnalog&#38;', '' );&#13;&#10;    strNalog := 'Уплата всех налогов за '+ sGod;&#13;&#10;  end;&#13;&#10;//  showmessage(Query.SQL.text);&#13;&#10;&#13;&#10;  MemoWrite('report.sql',Query.SQL.Text)                      &#13;&#10;end;&#13;&#10;&#13;&#10;procedure cbAllOnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  with cbAll, Engine do&#13;&#10;  begin&#13;&#10;  if cbAll.Checked&#13;&#10;    then edNalog.Enabled:=false&#13;&#10;    else edNalog.Enabled:=true;&#13;&#10;  end&#13;&#10;end;              &#13;&#10;&#13;&#10;procedure MasterData1OnBeforePrint(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  strAdres:=AdresFromID(&#60;Query.&#34;adres_id&#34;&#62;, true);                                                  &#13;&#10;  if nTypeObj=_TypeObj_Lich then begin&#13;&#10;    strLich:=&#60;Query.&#34;nomer&#34;&#62;;                          &#13;&#10;    strFIO:=&#60;Query.&#34;fio&#34;&#62;;                              &#13;&#10;  end else begin&#13;&#10;    strLich:=HouseLic(&#60;Query.&#34;adres_id&#34;&#62;);                                &#13;&#10;    strFIO:=HouseOwners(&#60;Query.&#34;adres_id&#34;&#62;, 1);                              &#13;&#10;  end;            &#13;&#10;end;&#13;&#10;&#13;&#10;procedure Memo12OnBeforePrint(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  if &#60;Query.&#34;SUM_VIST&#34;&#62;-&#60;Query.&#34;SUM_OPL&#34;&#62; &#62; 0&#13;&#10;    then Memo12.Text := '*'&#13;&#10;    else Memo12.Text := ''&#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." StoreInDFM="False" PropData="044C65667403300203546F7003C00008446174617365747301010C2400000020446174615365743D2251756572792220446174615365744E616D653D225175657279220000095661726961626C65730100055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxADSQuery Name="Query" UserName="Query" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="SELECT 0 adres_id, ' ' unp, ' ' nomer, ' ' fio, ' ' adres, 0 summa_vist, 0 summa_opl&#13;&#10;  FROM system.iota&#13;&#10;  " AdsConnection="dmBase.AdsConnection" SourceTableType="ttAdsADT" CharType="ANSI" RequestLive="False" PropData="05704C656674024F0470546F7002220A506172616D65746572730100"/>
  </TfrxDataPage>
  <TfrxDialogPage Name="DialogPage1" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Tahoma" Font.Style="0" BorderStyle="bsDialog" Caption="Введите значения" Color="-2147483633" Height="205" ClientHeight="167" Left="429" Top="111" Width="372" ClientWidth="356" OnShow="DialogPage1OnShow">
    <TfrxButtonControl Name="btOk" Left="177" Top="134" Width="75" Height="25" Font.Charset="1" Font.Color="-2147483640" Font.Height="-11" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Получить" Default="True" ModalResult="1" OnClick="btOkOnClick"/>
    <TfrxButtonControl Name="btCancel" Left="266" Top="134" Width="75" Height="25" Font.Charset="1" Font.Color="-2147483640" Font.Height="-11" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Cancel="True" Caption="Отказ" ModalResult="2"/>
    <TfrxLabelControl Name="Label2" Left="11" Top="11.5" Width="21" Height="16" Font.Charset="1" Font.Color="-2147483640" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Год" Color="-2147483633"/>
    <TfrxCheckBoxControl Name="cbDolg" Left="11" Top="42" Width="265" Height="17" Font.Charset="1" Font.Color="-2147483640" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Только должники          " Color="-2147483633"/>
    <TfrxMDBLookupComboBox Name="edNalog" Left="103" Top="87" Width="239" Height="25" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" ListField="NAME" KeyField="ID" NameOpisEdit="LOOKUP_NALOGI"/>
    <TfrxLabelControl Name="Label1" Left="11" Top="91.5" Width="65" Height="16" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Вид налога" Color="-16777201"/>
    <TfrxCheckBoxControl Name="cbAll" Left="11" Top="67" Width="261" Height="17" Font.Charset="1" Font.Color="-2147483640" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Все налоги" Checked="True" State="cbChecked" Color="-2147483633" OnClick="cbAllOnClick"/>
    <TfrxMaskEditControl Name="edGod" Left="52" Top="9" Width="56" Height="21" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Color="-16777211" EditMask="9999;1;_" MaxLength="4" Text="____"/>
    <TfrxMComboBoxControl Name="cbType" Left="150" Top="7" Width="161" Height="25" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" ShowHint="True" Color="-16777211" Items.Text="По лицевым счетам&#13;&#10;По адресной книге&#13;&#10;Все" KeyItems.Text="1&#13;&#10;2&#13;&#10;3" Style="csDropDownList" Text="По лицевым счетам" ItemIndex="0" ItemCount="0" KeyIndex="1"/>
  </TfrxDialogPage>
  <TfrxReportPage Name="Page2" PaperWidth="210" PaperHeight="297" PaperSize="256" LeftMargin="5" RightMargin="5" TopMargin="5" BottomMargin="5" ColumnWidth="0" ColumnPositions.Text="" Bin="65535" BinOtherPages="65535" HGuides.Text="" VGuides.Text="">
    <TfrxReportTitle Name="ReportTitle1" Height="34" Left="0" Top="16" Width="755.906">
      <TfrxMemoView Name="Memo11" Left="1" Top="4" Width="716" Height="29" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-16" Font.Name="Arial" Font.Style="1" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[strNalog]"/>
    </TfrxReportTitle>
    <TfrxHeader Name="MasterHeader1" Height="32" Left="0" Top="112" Width="755.906">
      <TfrxMemoView Name="Memo4" Left="255" Top="0" Width="80" Height="32" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РќР°С‡РёСЃР»РµРЅРѕ"/>
      <TfrxMemoView Name="Memo5" Left="335" Top="0" Width="70" Height="32" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РћРїР»Р°С‡РµРЅРѕ"/>
      <TfrxMemoView Name="Memo6" Left="613" Top="0" Width="61" Height="32" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="в„– СЃС‡РµС‚Р°"/>
      <TfrxMemoView Name="Memo3" Left="9" Top="0" Width="246" Height="32" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РђРґСЂРµСЃ"/>
      <TfrxMemoView Name="Memo9" Left="405" Top="0" Width="208" Height="32" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[strName]"/>
      <TfrxMemoView Name="Memo15" Left="674" Top="0" Width="79" Height="32" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[strUNP]"/>
    </TfrxHeader>
    <TfrxMasterData Name="MasterData1" Height="19" Left="0" Top="164" Width="755.906" OnBeforePrint="MasterData1OnBeforePrint" Columns="1" ColumnWidth="200" ColumnGap="20" DataSet="Query" DataSetName="Query" RowCount="0" Stretched="True">
      <TfrxMemoView Name="Memo1" ShiftMode="smDontShift" Left="254" Top="0" Width="77" Height="18" ShowHint="False" StretchMode="smMaxHeight" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[Query.&#34;SUM_VIST&#34;]"/>
      <TfrxMemoView Name="Memo2" ShiftMode="smDontShift" Left="335" Top="0" Width="69" Height="18" ShowHint="False" StretchMode="smMaxHeight" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[Query.&#34;SUM_OPL&#34;]"/>
      <TfrxMemoView Name="mLich" ShiftMode="smDontShift" Left="613" Top="0" Width="61" Height="18" ShowHint="False" StretchMode="smMaxHeight" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[strLich]"/>
      <TfrxMemoView Name="Memo8" ShiftMode="smDontShift" Left="9" Top="0" Width="245" Height="18" ShowHint="False" StretchMode="smMaxHeight" Font.Charset="204" Font.Color="0" Font.Height="-13" Font.Name="Times New Roman" Font.Style="0" ParentFont="False" VAlign="vaCenter" Text="[strAdres]"/>
      <TfrxMemoView Name="Memo10" ShiftMode="smDontShift" Left="405" Top="0" Width="208" Height="18" ShowHint="False" StretchMode="smMaxHeight" Font.Charset="204" Font.Color="0" Font.Height="-13" Font.Name="Times New Roman" Font.Style="0" ParentFont="False" VAlign="vaCenter" Text="[strFIO]"/>
      <TfrxMemoView Name="Memo12" Left="1" Top="5" Width="9" Height="13" OnBeforePrint="Memo12OnBeforePrint" ShowHint="False" StretchMode="smMaxHeight" Font.Charset="204" Font.Color="0" Font.Height="-16" Font.Name="Times New Roman" Font.Style="1" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text=""/>
      <TfrxLineView Name="Line1" Left="12" Top="19" Width="740" Height="0" ShowHint="False" StretchMode="smMaxHeight" Frame.Typ="4"/>
      <TfrxMemoView Name="mUNP" ShiftMode="smDontShift" Left="674" Top="0" Width="76" Height="18" ShowHint="False" StretchMode="smMaxHeight" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" ParentFont="False" WordWrap="False" VAlign="vaCenter" Text="[Query.&#34;unp&#34;]"/>
    </TfrxMasterData>
    <TfrxFooter Name="MasterFooter1" Height="20" Left="0" Top="204" Width="755.906">
      <TfrxMemoView Name="Memo13" Left="254" Top="0" Width="77" Height="20" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" HAlign="haRight" ParentFont="False" VAlign="vaBottom" Text="[SUM(&#60;Query.&#34;SUM_VIST&#34;&#62;,0,1)]"/>
      <TfrxMemoView Name="Memo14" Left="335" Top="0" Width="69" Height="20" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-15" Font.Name="Times New Roman" Font.Style="0" HAlign="haRight" ParentFont="False" VAlign="vaBottom" Text="[SUM(&#60;Query.&#34;SUM_OPL&#34;&#62;,0,1)]"/>
    </TfrxFooter>
  </TfrxReportPage>
</TfrxReport>
