<?xml version="1.0" encoding="utf-8"?>
<TfrxReport Version="4.12" DotMatrixReport="False" IniFile="E:\Projects\Selsovet7\Work\FastReports.ini" OldStyleProgress="True" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.Author="Вадим Чура" ReportOptions.CreateDate="38251.4373884143" ReportOptions.Description.Text="" ReportOptions.Name="Запись акта о браке" ReportOptions.LastChange="43825.7405317708" ReportOptions.VersionMajor="1" ReportOptions.VersionMinor="1" ReportOptions.VersionRelease="1" ScriptLanguage="PascalScript" ScriptText.Text="var&#13;&#10;  DateBegin, DateEnd : TDateTime;                  &#13;&#10;  sMin, sMax, ss, sd, strPeriod : String;              &#13;&#10;           &#13;&#10;procedure DialogPage1OnShow(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  if IDProg()&#60;&#62;'ZAGS' then begin&#13;&#10;    cbAll.Visible:=false;&#13;&#10;  end;  &#13;&#10;  edDateBegin.Date:=GetLastValue('RAST_BR_DATE1','D');            &#13;&#10;  edDateEnd.Date:=GetLastValue('RAST_BR_DATE2','D');          &#13;&#10;  cbAll.Checked:=GetLastValue('ALL_ZAGS','L');          &#13;&#10;end;&#13;&#10;&#13;&#10;procedure Page2OnBeforePrint(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  with Page1, Engine do&#13;&#10;  begin&#13;&#10;//  s := GetAdres('MAIN');&#13;&#10;//  s := ChoiceKey('KEY_TUL');&#13;&#10;//  if Length(s)&#62;0 then begin&#13;&#10;//    ss:=ValueKey('KEY_TUL',s);&#13;&#10;//    Edit1.text:=s+'/'+ss;&#13;&#10;//  end;&#13;&#10;//  MessageBox(Parameters(' main_select'),'');&#13;&#10;  end&#13;&#10;end;&#13;&#10;&#13;&#10;procedure Button1OnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;&#13;&#10;  DateBegin := edDateBegin.Date; // FormatDateTime('yyyy-mm-dd',DATE);&#13;&#10;  DateEnd   := edDateEnd.Date;   // FormatDateTime('yyyy-mm-dd',DATE);&#13;&#10;  strPeriod :=  'c ' + FormatDateTime('dd.mm.yyyy',edDateBegin.Date)+'г. по '+FormatDateTime('dd.mm.yyyy',edDateEnd.Date)+'г.';&#13;&#10;  sd:='datez&#62;='+DateToSQL(DateBegin)+' and datez&#60;='+DateToSQL(DateEnd);            &#13;&#10;  &#13;&#10;  Query1.SQL.Text := Replace(Query1.SQL.Text, '&#38;VOZRAST_M&#38;', GetSQLVozrast('datez','on_dater'));&#13;&#10;  Query1.SQL.Text := Replace(Query1.SQL.Text, '&#38;VOZRAST_G&#38;', GetSQLVozrast('datez','ona_dater'));&#13;&#10;    &#13;&#10;  ss:='';&#13;&#10;  if not cbAll.Checked &#13;&#10;    then ss:=sd+' and id_zags='+Parameters('ID')&#13;&#10;    else ss:=sd;&#13;&#10;  ss:=ss+' and type_rast=1';                    &#13;&#10;  Query1.SQL.Text := Replace(Query1.SQL.Text, 'true=true', ss);&#13;&#10;  MemoWrite('report.sql', Query1.SQL.Text);                        &#13;&#10;//  messageBox(copy(Query1.SQL,5000,4000),'');&#13;&#10;  OpenMessage('Предварительный запрос ...','');&#13;&#10;  ss:=Query2.SQL.Text;&#13;&#10;  try          &#13;&#10;    Query2.SQL.Text:=Replace(ss, 'true=true', sd+' and type_rast=1');&#13;&#10;    Query2.Open;&#13;&#10;    sMin:='Минимальная продолжительность брака '+SubDatePropis(&#60;Query2.&#34;datez&#34;&#62;, &#60;Query2.&#34;brak_date&#34;&#62;, 0)+','+crlf+' з/а №'+&#13;&#10;           inttostr(&#60;Query2.&#34;nomer&#34;&#62;)+' от '+DatePropis(&#60;Query2.&#34;datez&#34;&#62;,3)+'г.';                                                    &#13;&#10;    Query2.Close;&#13;&#10;&#13;&#10;    Query2.SQL.Text:=Replace(ss, 'true=true', sd+' and type_rast=1')+' desc';&#13;&#10;    Query2.Open;&#13;&#10;    sMax:='Максимальная продолжительность брака '+SubDatePropis(&#60;Query2.&#34;datez&#34;&#62;, &#60;Query2.&#34;brak_date&#34;&#62;, 0)+','+crlf+' з/а №'+&#13;&#10;           inttostr(&#60;Query2.&#34;nomer&#34;&#62;)+' от '+DatePropis(&#60;Query2.&#34;datez&#34;&#62;,3)+'г.';                                                    &#13;&#10;  &#13;&#10;    Query2.Close;&#13;&#10;  finally                  &#13;&#10;    CloseMessage();&#13;&#10;  end;&#13;&#10;&#13;&#10;  SetLastValue('RAST_BR_DATE1',edDateBegin.Date, 'D');&#13;&#10;  SetLastValue('RAST_BR_DATE2',edDateEnd.Date, 'D');            &#13;&#10;  SetLastValue('ALL_ZAGS',cbAll.Checked, 'L');          &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." StoreInDFM="False" PropData="044C65667403A80203546F7003000108446174617365747301010C2600000020446174615365743D225175657279312220446174615365744E616D653D225175657279312200010C2600000020446174615365743D225175657279322220446174615365744E616D653D22517565727932220000095661726961626C65730100055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxADSQuery Name="Query1" UserName="Query1" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="select 'до 1 года' brak_time, count(*) kolvo from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;1&#13;&#10;  union all&#13;&#10;select 'от 1 года до 2 лет' kolvo, count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=1 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;2&#13;&#10;  union all&#13;&#10;select 'от 2 лет до 3 лет' kolvo, count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=2 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;3&#13;&#10;  union all&#13;&#10;select 'от 4 лет до 5 лет' kolvo, count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=3 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;5&#13;&#10;  union all&#13;&#10;select 'от 0 лет до 5 лет' kolvo, count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;5&#13;&#10;  union all&#13;&#10;select 'от 5 лет до 10 лет' kolvo, count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=5 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;10&#13;&#10;  union all&#13;&#10;select 'от 10 лет до 15 лет' kolvo, count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=10 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;15&#13;&#10;  union all&#13;&#10;select 'от 15 лет до 25 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=15 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;20&#13;&#10;  union all&#13;&#10;select 'от 20 лет до 25 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=20 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;25&#13;&#10;  union all&#13;&#10;select 'от 25 лет до 30 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=25 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;30&#13;&#10;  union all&#13;&#10;select 'от 30 лет до 40 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=30 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;40&#13;&#10;  union all&#13;&#10;select 'от 40 лет до 50 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=40 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;50&#13;&#10;  union all&#13;&#10;select 'от 50 лет до 60 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=50 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;60&#13;&#10;  union all&#13;&#10;select 'от 60 лет до 70 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=60 and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#60;70&#13;&#10;  union all&#13;&#10;select 'более 70 лет' kolvo,count(*) from akttermmarriage a where true=true and brak_date is not null and TIMESTAMPDIFF(SQL_TSI_YEAR,brak_date,datez)&#62;=70&#13;&#10;  union all&#13;&#10;select 'неизвестно' kolvo,count(*) from akttermmarriage a where true=true and brak_date is null&#13;&#10;  union all&#13;&#10;select 'Всего' kolvo,count(*) from akttermmarriage a where true=true" SourceTableType="ttAdsADT" CharType="ANSI" RequestLive="False" PropData="05704C65667402580470546F7002530A506172616D65746572730100"/>
    <TfrxADSQuery Name="Query2" UserName="Query2" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="select top 1 nomer, datez-brak_date delta, datez, brak_date from akttermmarriage a where true=true and brak_date is not null order by datez-brak_date " SourceTableType="ttAdsADT" CharType="ANSI" RequestLive="False" PropData="05704C65667403A3000470546F7002540A506172616D65746572730100"/>
  </TfrxDataPage>
  <TfrxDialogPage Name="DialogPage1" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Tahoma" Font.Style="0" BorderStyle="bsDialog" Caption="Возрастные категории расторгающих браков" Color="-2147483633" Height="172" ClientHeight="134" Left="366" Top="161" Width="337" ClientWidth="321" OnShow="DialogPage1OnShow">
    <TfrxButtonControl Name="Button1" Left="152" Top="102" Width="75" Height="25" Font.Charset="1" Font.Color="-2147483640" Font.Height="-11" Font.Name="MS Sans Serif" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Получить" Default="True" ModalResult="1" OnClick="Button1OnClick"/>
    <TfrxButtonControl Name="Button2" Left="243" Top="101" Width="75" Height="25" Font.Charset="1" Font.Color="-2147483640" Font.Height="-11" Font.Name="MS Sans Serif" Font.Style="0" ParentFont="False" ShowHint="True" Cancel="True" Caption="Отказ" ModalResult="2"/>
    <TfrxDateEditControl Name="edDateBegin" Left="211" Top="19" Width="111" Height="22" Font.Charset="1" Font.Color="-2147483640" Font.Height="-11" Font.Name="MS Sans Serif" Font.Style="0" ParentFont="False" ShowHint="True" Color="-2147483643" Date="43825" Time="43825" WeekNumbers="False"/>
    <TfrxDateEditControl Name="edDateEnd" Left="211" Top="50" Width="111" Height="22" Font.Charset="1" Font.Color="-2147483640" Font.Height="-11" Font.Name="MS Sans Serif" Font.Style="0" ParentFont="False" ShowHint="True" Color="-2147483643" Date="43825" Time="43825" WeekNumbers="False"/>
    <TfrxLabelControl Name="Label3" Left="14" Top="21" Width="106" Height="16" Font.Charset="1" Font.Color="-2147483640" Font.Height="-13" Font.Name="MS Sans Serif" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Начальная дата" Color="-2147483633"/>
    <TfrxLabelControl Name="Label4" Left="14" Top="52" Width="97" Height="16" Font.Charset="1" Font.Color="-2147483640" Font.Height="-13" Font.Name="MS Sans Serif" Font.Style="0" ParentFont="False" ShowHint="True" Caption="Конечная дата" Color="-2147483633"/>
    <TfrxCheckBoxControl Name="cbAll" Left="15" Top="76" Width="276" Height="17" Font.Charset="1" Font.Color="-16777208" Font.Height="-11" Font.Name="MS Sans Serif" Font.Style="0" ParentFont="False" ShowHint="True" Caption="З/а всех органов регистрации" Color="-16777201"/>
  </TfrxDialogPage>
  <TfrxReportPage Name="Page1" PaperWidth="209.99979167" PaperHeight="297.00008333" PaperSize="256" LeftMargin="21.1666666666667" RightMargin="5.000625" TopMargin="5.000625" BottomMargin="5.000625" Columns="1" ColumnWidth="200.0011875" ColumnPositions.Text="0" HGuides.Text="" VGuides.Text="">
    <TfrxReportTitle Name="ReportTitle1" Height="76" Left="0" Top="29" Width="694.800448737598">
      <TfrxMemoView Name="Memo3" Left="8" Top="5" Width="500" Height="55" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-21" Font.Name="Times New Roman" Font.Style="1" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РџСЂРѕРґРѕР»Р¶РёС‚РµР»СЊРЅРѕСЃС‚СЊ СЃСѓС‰РµСЃС‚РІРѕРІР°РЅРёСЏ Р±СЂР°РєР°&#13;&#10;Р·Р° РїРµСЂРёРѕРґ [strPeriod]"/>
    </TfrxReportTitle>
    <TfrxHeader Name="MasterHeader1" Height="37" Left="0" Top="163" Width="694.800448737598">
      <TfrxMemoView Name="Memo4" Left="7" Top="2" Width="299" Height="35" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-19" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РІСЂРµРјСЏ РІ Р±СЂР°РєРµ"/>
      <TfrxMemoView Name="Memo5" Left="306" Top="2" Width="124" Height="35" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-19" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РєРѕР»РёС‡РµСЃС‚РІРѕ"/>
    </TfrxHeader>
    <TfrxMasterData Name="MasterData1" Height="24" Left="0" Top="232" Width="694.800448737598" ColumnWidth="0" ColumnGap="0" DataSet="Query1" DataSetName="Query1" RowCount="0">
      <TfrxMemoView Name="Memo1" Left="7" Top="0" Width="299" Height="24" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-19" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" GapX="10" ParentFont="False" VAlign="vaCenter" Text="[Query1.&#34;brak_time&#34;]"/>
      <TfrxMemoView Name="Memo2" Left="306" Top="0" Width="124" Height="24" ShowHint="False" Font.Charset="204" Font.Color="0" Font.Height="-19" Font.Name="Times New Roman" Font.Style="0" Frame.Typ="15" GapX="5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[Query1.&#34;kolvo&#34;]"/>
    </TfrxMasterData>
    <TfrxFooter Name="Footer1" Height="101" Left="0" Top="480" Width="694.800448737598">
      <TfrxMemoView Name="Memo6" Left="5" Top="7" Width="681" Height="40" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-19" Font.Name="Times New Roman" Font.Style="0" ParentFont="False" Text="[sMin]"/>
      <TfrxMemoView Name="Memo7" Left="5" Top="52" Width="681" Height="44" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-19" Font.Name="Times New Roman" Font.Style="0" ParentFont="False" Text="[sMax]"/>
    </TfrxFooter>
  </TfrxReportPage>
</TfrxReport>
